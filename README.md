# 🚀 Factory.ai API 余额监控系统 v2.0

一个功能完善的 Factory.ai API Keys 使用情况监控系统,支持可视化看板、历史趋势分析和完整的 Key 管理功能。

## ✨ 核心功能

### 📊 实时监控
- ✅ **实时余额查询** - 查询所有 API Keys 的余额和使用情况
- ✅ **可视化看板** - 美观的统计卡片和数据表格
- ✅ **使用率监控** - 实时显示每个 Key 的使用百分比和进度条

### 📈 数据分析
- ✅ **历史数据记录** - 自动保存使用量历史
- ✅ **趋势图表** - Chart.js 可视化展示 token 使用趋势
- ✅ **分组统计** - 按环境分组(生产/开发/测试)统计

### 🔧 Key 管理
- ✅ **添加 Key** - 通过界面直接添加新的 API Key
- ✅ **编辑 Key** - 修改别名、分组、备注等信息
- ✅ **删除 Key** - 删除不再使用的 Keys
- ✅ **批量测试** - 一键测试所有 Keys 的有效性
- ✅ **即时同步** - 所有操作立即保存到本地配置文件

### 🎨 交互功能
- ✅ **搜索功能** - 快速搜索 Key ID、别名或分组
- ✅ **数据筛选** - 按分组、状态筛选 Keys
- ✅ **表格排序** - 点击表头按任意列排序
- ✅ **自动刷新** - 可设置自动刷新间隔(默认5分钟)

## 🚀 快速开始

### 📋 系统要求

**必须安装:**
- ✅ **Node.js** (版本 12 或更高) - [点击下载](https://nodejs.org)
  - 如何检查是否已安装: 打开命令行,运行 `node --version`
  - 如果显示版本号(如 `v18.x.x`),说明已安装
  - 如果提示"命令不存在",需要先安装 Node.js

**推荐环境:**
- Windows 操作系统 (Mac/Linux 也可用,见下方说明)
- 稳定的网络连接

### ⚡ 一键启动 (Windows)

**只需双击 `启动.bat` 文件!**

系统会自动:
1. 启动后端服务
2. 等待 3 秒
3. 自动打开浏览器
4. 显示监控看板

就这么简单! 🎉

### 📊 使用步骤

#### 1. 启动系统
双击 `启动.bat` 文件

你会看到:
```
================================================================================
🚀 Factory.ai API 余额监控系统 v2.0
================================================================================

正在启动服务...
正在打开浏览器...

✅ 服务已启动! 浏览器已自动打开
📊 访问地址: http://localhost:8000
================================================================================
```

#### 2. 配置 API Keys

**方法一: 通过界面添加 (推荐)**

1. 点击页面右上角的 **"➕ 添加 Key"** 按钮
2. 填写表单:
   - **Key ID**: 唯一标识符 (如: `key-1`, `prod-main`)
   - **API Key**: 你的 Factory.ai API key (以 `fk-` 开头)
   - **别名**: 显示名称 (如: `dsd06662+1@gmail.com`)
   - **分组**: 选择分组 (production/development/testing)
   - **备注**: 可选的详细说明
3. 点击 **"保存"** 按钮
4. 系统会自动保存到 `config.json` 并刷新数据

**方法二: 直接编辑配置文件**

编辑 `config.json`:

```json
{
  "apiKeys": [
    {
      "id": "key-1",
      "key": "fk-your-actual-key-here",
      "alias": "账户名或描述",
      "group": "production",
      "note": "备注信息",
      "enabled": true
    }
  ],
  "settings": {
    "autoRefreshInterval": 300000,
    "alertThreshold": 0.8,
    "historyRetentionDays": 30
  }
}
```

保存后,刷新浏览器页面即可看到更新。

#### 3. 查看余额

系统会自动显示:
- **统计卡片** - 总计额度、已使用、剩余额度、使用率
- **趋势图表** - 最近使用趋势(需要运行一段时间积累数据)
- **详细表格** - 每个 Key 的详细信息

## 📊 界面功能

### 顶部按钮
- **➕ 添加 Key** - 添加新的 API Key
- **🔍 批量测试** - 测试所有 Keys 的有效性
- **⏱️ 自动刷新** - 启用/停止自动刷新(每5分钟)
- **🔄 刷新** - 手动刷新数据

### 搜索和筛选
- **搜索框** - 实时搜索 Key ID、别名或分组
- **分组筛选** - 按环境筛选 (production/development/testing)
- **状态筛选** - 筛选有效/错误的 Keys

### 数据表格
- **可排序** - 点击表头按任意列排序
- **进度条** - 直观显示使用率
- **操作按钮** - 每行都有编辑✏️和删除🗑️按钮
- **悬停提示** - 鼠标悬停显示完整备注信息

## 📁 项目结构

```
factory-balance-monitor/
├── 启动.bat              # 🚀 一键启动脚本 (双击即可)
├── server.js             # 后端服务 (Node.js)
├── index.html            # 前端界面 (纯静态HTML)
├── config.json           # 配置文件 (自动创建)
├── data/                 # 数据目录
│   └── history.json      # 历史数据 (自动生成)
├── README.md             # 本文档
└── .gitignore            # Git 忽略配置
```

## ⚙️ 配置说明

### config.json 结构

```json
{
  "apiKeys": [
    {
      "id": "唯一标识符",
      "key": "Factory.ai API Key (fk-...)",
      "alias": "显示名称/账户名",
      "group": "分组名称",
      "note": "备注信息",
      "enabled": true
    }
  ],
  "settings": {
    "autoRefreshInterval": 300000,      // 自动刷新间隔(毫秒) 默认5分钟
    "alertThreshold": 0.8,              // 告警阈值(80%) 预留功能
    "historyRetentionDays": 30          // 历史数据保留天数
  }
}
```

### 推荐分组

- `production` - 生产环境
- `development` - 开发环境
- `testing` - 测试环境
- `default` - 默认分组

你也可以创建自定义分组名称。

## 🎯 使用场景

### 场景1: 个人使用
- 管理多个 Factory.ai 账户
- 监控每个账户的余额使用情况
- 避免余额不足导致服务中断

### 场景2: 团队协作
- 为不同环境创建不同的 Keys
- 使用分组和别名清晰区分
- 添加备注说明 Key 的用途和负责人

### 场景3: 成本控制
- 查看使用趋势图,预测未来消耗
- 监控剩余额度,及时充值
- 筛选高使用率的 Keys,优化使用

## 🔧 API 接口

系统提供了完整的 RESTful API 接口:

### 数据查询
- `GET /api/data` - 获取所有 Keys 的使用情况
- `GET /api/config` - 获取配置(Key 已掩码)
- `GET /api/history` - 获取历史数据

### Key 管理
- `POST /api/keys` - 添加新 Key
- `PUT /api/keys/{keyId}` - 更新 Key
- `DELETE /api/keys/{keyId}` - 删除 Key
- `POST /api/test-key` - 测试 Key 有效性

### 配置管理
- `POST /api/config` - 更新完整配置

## 🔒 安全建议

### ✅ 已实现的安全措施
1. **API Key 保护** - Key 仅存储在本地,不上传到任何服务器
2. **掩码显示** - 界面只显示 Key 的部分内容
3. **本地访问** - 默认只监听 localhost,外网无法访问

### 💡 安全提示
1. **不要将 config.json 提交到公开的代码仓库** (已添加到 .gitignore)
2. **定期更新 API Keys** - 定期轮换 Keys 提高安全性
3. **限制访问权限** - 确保只有授权人员可以访问本机
4. **定期备份配置** - 备份 `config.json` 和 `data/history.json`

## 🐛 故障排查

### 问题: 双击启动.bat 后闪退

**解决方案**:
1. 检查是否安装了 Node.js: 打开命令行输入 `node --version`
2. 如未安装,请访问 https://nodejs.org 下载安装
3. 重新启动系统后再次尝试

### 问题: 浏览器打开后显示"无法连接"

**解决方案**:
1. 检查命令行窗口是否有错误信息
2. 确认端口 8000 没有被其他程序占用
3. 尝试手动访问: http://127.0.0.1:8000

### 问题: 无法加载数据或显示错误

**解决方案**:
1. 检查 `config.json` 中的 API Keys 是否正确
2. 检查网络连接是否正常
3. 查看控制台日志中的错误信息
4. 尝试单独测试某个 Key (使用批量测试功能)

### 问题: 历史数据丢失

**解决方案**:
1. 检查 `data/` 目录是否存在
2. 确保有文件写入权限
3. 检查 `data/history.json` 文件是否损坏
4. 如果损坏,删除该文件,系统会自动重新创建

## 📝 更新日志

### v2.0.0 (2025-01)
- ✨ 添加独立配置文件支持
- ✨ 实现配置热加载
- ✨ 添加历史数据记录和趋势图表
- ✨ 实现 Key 分组管理
- ✨ 添加自定义别名和备注功能
- ✨ 实现数据筛选、排序、搜索
- ✨ 添加自动刷新功能
- ✨ 实现批量测试 Keys 有效性
- ✨ 支持界面上添加/编辑/删除 Keys
- ✨ 所有配置自动同步到本地文件
- 🎨 全新的用户界面设计
- 📊 集成 Chart.js 图表库
- 🚀 一键启动脚本

### v1.0.0 (2025-01)
- 🎉 初始版本发布
- ✅ 基础余额查询功能
- ✅ 简单的 Web 界面

## ❓ 常见问题

**Q: 需要安装什么软件才能运行?**
A: 只需要安装 **Node.js** (版本 12 或更高)。不需要安装任何其他依赖包!
   - Windows: 访问 https://nodejs.org 下载安装包
   - 安装完成后,重启电脑
   - 验证安装: 打开命令行输入 `node --version`

**Q: 支持哪些操作系统?**
A: 目前只提供了 Windows 批处理文件(.bat),但代码本身是跨平台的。Mac/Linux 用户可以直接运行 `node server.js`,然后访问 http://localhost:8000

**Q: 可以同时监控多少个 API Keys?**
A: 理论上没有限制,但建议不超过 50 个,以保证查询性能。

**Q: 数据多久刷新一次?**
A: 手动刷新是实时的。自动刷新默认每 5 分钟一次(可在设置中修改)。

**Q: 历史数据保存多久?**
A: 默认保存 30 天,可在 `config.json` 的 `historyRetentionDays` 设置中修改。

**Q: 可以导出数据吗?**
A: 当前版本暂不支持直接导出,但你可以直接访问 `data/history.json` 文件获取原始数据。

**Q: 忘记了某个 Key 是哪个账户的怎么办?**
A: 在表格中查看"别名"列,或点击编辑按钮查看完整的备注信息。

## 📞 支持与反馈

如有问题或建议,请:
1. 查看本 README 的故障排查部分
2. 检查控制台日志中的错误信息
3. 联系系统管理员或开发者

## 📄 许可证

MIT License

---

**享受使用 Factory.ai API 余额监控系统 v2.0!** 🚀

💡 **提示**: 首次使用请先添加你的 API Keys,然后就可以实时监控余额了!
